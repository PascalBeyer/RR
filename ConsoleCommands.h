#ifndef RR_CONSOLECOMMANDS
#define RR_CONSOLECOMMANDS

static char lorum[] = "Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.";



static void HelloHelper(StringArray args)
{
	ConsoleOutput("Hello!");
}

static void LorumHelper(StringArray args)
{
	ConsoleOutput(lorum);
}

static void AddHelper(StringArray args)
{
	b32 success = true;
	u32 inp1 = StoU(args[0], &success);
	u32 inp2 = StoU(args[1], &success);
   
	if (!success)
	{
		ConsoleOutput("Arguments did not match!");
		return;
	}
   
	u32 sum = inp1 + inp2;
	ConsoleOutput("%i32 + %i32 = %i32", inp1, inp2, sum);
}


static void ClearHelper(StringArray args)
{
	console.commandHistory->length = 0;
	console.historyLength = 0;
	console.historyPos = 0;
	Clear(console.arena);
}

static void HelpHelper(StringArray args)
{
	ConsoleOutput("Console Commands are:");
   
	For(console.commands)
	{
		ConsoleOutput("    %s", it->name);
	}
}



static void WriteDebugVariables();
static void WriteSingleTweeker(Tweeker tweeker);


// todo : make this need file names
static void TweekHelper(StringArray args)
{
	if (args.amount == 0)
	{
		For(globalTweekers.tweekers)
		{
			ConsoleOutput("%s %s", it->name, TweekerToString(*it));
		}
      
		return;
	}
   
	Tweeker *toTweek = GetTweeker(args[0]);
	
	if(!toTweek) 
	{
		ConsoleOutputError("Error: Tweeker not found!", HistoryEntry_Error); // todo : nearest match?
		return;
	}
   
	if (args.amount == 1)
	{
		if (toTweek->type == Tweeker_v4)
		{
			ColorPicker picker = CreateColorPicker(&toTweek->vec4);
			picker.tweeker = toTweek;
			picker.isTweeker = true;
			ArrayAdd(&gameState.editor.colorPickers, picker);
		}
      
		ConsoleOutput("Current Tweeker Value is: %s", TweekerToString(*toTweek)); 
		return;
	}
   
	Tweeker save = *toTweek;
	b32 success = true;
	switch (toTweek->type)
	{
      case Tweeker_b32:
      {	
         b32 val = StoB(args[1], &success);
         if (success) toTweek->b = val;
      }break;
      case Tweeker_u32:
      {
         u32 val = StoU(args[1], &success);
         if (success) toTweek->u = val;
      }break;
      case Tweeker_f32:
      {
         f32 val = StoF(args[1], &success);
         if (success) toTweek->f = val;
      }break;
      
      case Tweeker_v2:
      {
         v2 val = StoV2(args[1], &success);
         if (success) toTweek->vec2 = val;
      }break;
      
      case Tweeker_v3:
      {
         v3 val = StoV3(args[1], &success);
         if (success) toTweek->vec3 = val;
      }break;
      case Tweeker_v4:
      {
         v4 val = StoV4(args[1], &success);
         if (success) toTweek->vec4 = val;
      }break;
      default:
		ConsoleOutputError("Unhandled Tweeker Type in Tweek Helper!");
		return;
	}
   
	if (!success)
	{
		ConsoleOutputError("Could not parse the value for tweeker %s", toTweek->name);
		ConsoleOutputError("Value remains: %s", TweekerToString(*toTweek));
		return;
	}
   
	ConsoleOutput("Tweeked %s: %s -> %s!", toTweek->name, TweekerToString(save), TweekerToString(*toTweek));
   
	WriteSingleTweeker(*toTweek);
}

static void SaveTweekersHelper(StringArray args)
{
	if (args[0] == "tweekers")
	{
		WriteDebugVariables();
		ConsoleOutput("Saved Tweekers!");
		return;
	}
	
   
	ConsoleOutput("Don't know what to save! (Could not read input).");
}


static void TweekersHelper(StringArray args)
{
	For(globalTweekers.tweekers)
	{
		ConsoleOutput("%s %s", it->name, TweekerToString(*it));
	}
}

static void GrisuHelper(StringArray args)
{
	b32 success = true;
	f32 ret = StoF(args[0], &success);
	if (success)
	{
		ConsoleOutput("parsed float is %f32", ret);
		Grisu(frameArena, ret);
	}
	else
	{
		ConsoleOutput("Could not read float");
	}
}

static void ConvertHelper(StringArray args)
{
	DeferRestore(frameArena);
   
	String head = args[0];
	String type = EatToCharFromBackReturnTail(&head, '.');
	if (!head.length)
	{
		ConsoleOutputError("No filetype found!");
		return;
	}
   
	char* nameToLoad = ToNullTerminated(frameArena, args[0]);		
	String name = EatToCharFromBackReturnTail(&head, '/');
	if (type == "bmp")
	{
		String nameToSave = FormatString("textures/%stexture\n", name);
		nameToSave[nameToSave.length - 1] = '\0'; // todo  hack... maybe make this a version of format string
		Bitmap bitmap = CreateBitmap(nameToLoad);
      
		if (!bitmap.pixels)
		{
			ConsoleOutputError("Could not find bitmap %c*.", nameToLoad);
			return;
		}
      
		if (bitmap.height != Asset_Bitmap_Size || bitmap.width != Asset_Bitmap_Size)
		{
			ConsoleOutputError("Bitmap does not have standart bitmap size.", nameToLoad);
			return;
		}
      
		WriteTexture((char *)nameToSave.data, bitmap);
		ConsoleOutput("Converted bitmap %c* to texture %s", nameToLoad, nameToSave);
		return;
	} 
	else if(type == "obj")
	{
		char *nameToSave = FormatCString("mesh/%smesh", name);
		TriangleMesh mesh = ReadObj(nameToLoad, frameArena);
		if (!mesh.positions.amount)
		{
			ConsoleOutputError("Probably file name wrong. Might have loaded a mesh w/0 vertices.");
			return;
		}
		WriteTriangleMesh(mesh, nameToSave);
		ConsoleOutput("Converted .obj %c* to .mesh %c*", nameToLoad, nameToSave);
		return;
	}
   
	ConsoleOutputError("Unrecognized Format!");
}

static void SaveLevelHelper(StringArray args)
{
   if(gameState.mode != Game_Editor)
   {
      ConsoleOutputError("Saving Levels only allowed in Editor.");
      return;
   }
   
   if(args[0] == "")
   {
      ConsoleOutputError("Empty Name not allowed.");
      return;
   }
   
	char *fileName = FormatCString("level/%s.level", args[0]);
   
   Level level = EditorStateToLevel(&gameState.editor);
	if(!WriteLevel(fileName, level, &gameState.assetHandler))
   {
      ConsoleOutputError("An error accured while trying to save the level.!");
   }
   gameState.entityManager.levelName = CopyString(args[0], gameState.currentStateArena); // todo leak
   ConsoleOutputError("Done!");
}

static void LoadLevelHelper(StringArray args)
{
   if(gameState.mode != Game_Editor)
   {
      ConsoleOutputError("Loading Levels only allowed in Editor.");
      return;
   }
   
   if(args[0] == "")
   {
      ConsoleOutputError("Empty Name not allowed.");
      return;
   }
   
   Level level = LoadLevel(args[0], frameArena, &gameState.assetHandler);
   Clear(gameState.currentStateArena);
   EditorLoadLevel(&gameState.editor, gameState.currentStateArena, &level);
   
   if (!level.name.amount)
   {
      ConsoleOutputError("Tried to load \"level/%s.level\", no such file or directory!", args[0]);
   }
   
   ConsoleOutput("Loaded level %s!", args[0]);
   return;
   
}

static void NewLevelHelper(StringArray args)
{
   if(gameState.mode != Game_Editor)
   {
      ConsoleOutputError("Loading Levels only allowed in Editor.");
      return;
   }
   
   NewLevel(&gameState.editor);
   
   ConsoleOutput("New Level! Save with 'saveLevel' command.");
}

static void AddMeshHelper(StringArray args)
{
   if (gameState.editor.state != EditorState_Default)
   {
		ConsoleOutputError("Editor is in a mode other then 'Default'. This is not 'yet' allowed.");
		return;
   }
   
   b32 succsess = true;
   String name = FormatString("%s.mesh", args[0]);
   u32 id = RegisterAsset(&gameState.assetHandler, Asset_Mesh, name, &succsess);
   
   if (succsess)
   {
		TriangleMesh *mesh = GetMesh(&gameState.assetHandler, id);
		EntityCopyData data;
		data.color = V4(1, 1, 1, 1);
		data.meshId = id;
		data.orientation = { 1, 0, 0, 0 };
		data.physicalPos = V3i();
		data.offset = V3();
		data.scale = 1.0f;
		data.type = Entity_None;
		data.flags = 0;
		
		gameState.editor.clipBoard.amount = 1;
		gameState.editor.clipBoard[0] = data;
      
		gameState.editor.state = EditorState_PlacingNewMesh;
		EditorSelectNothing(&gameState.editor);
   }
}

static void SaveCameraHelper(StringArray args)
{
   gameState.editor.levelInfo.camera = gameState.editor.camera;
}


static void SetLightHelper(StringArray args)
{
   gameState.editor.levelInfo.lightSource.orientation = gameState.editor.camera.orientation;
   gameState.editor.levelInfo.lightSource.pos         = gameState.editor.camera.pos;
}



#endif // ! RR_CONSOLECOMMANDS

